@using PortalMonti.Domain.Model;
@model PortalMonti.Application.ViewModels.Post.ListPostForListVm;



@{
    ViewData["Title"] = "Index";

}

@*<h1>Wyszukiwarka Postów</h1>

    <p>
        <a asp-action="AddPost">Dodaj  post</a>
    </p>*@
<div id="addpost" style="display: none">@await Html.PartialAsync("_AddPostPartial", new PortalMonti.Application.ViewModels.Post.NewPostVm())</div>



<form asp-action="Index" asp-controller="Post" method="post">



    <div class="row row2">
        <div class="col-md-8">
            <div>
                <div class="input-group">
                    <div class="form-outline">
                        <input type="text" asp-for="SearchString" name="searchString" id="searchString" class="form-control" height="30" />
                        <label class="form-label" for="form1">Szukaj</label>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-search"></i>
                    </button>

                </div> @if (Model.SearchString != String.Empty)
                {
                    <a asp-action="Index">Back to List</a>
                }
                <br />
            </div>
            <input type="hidden" name="pageNo" id="pageNo" />
        </div>
    </div>            <input type="hidden" name="pageSize" id="pageSize" value="8" />
</form>            
<button id="btn2" class="btn btn-success" style="margin-left:4px">Dodaj Post</button>
<br />

<!-- Post /////-->



<div class="row row2">
    <div class="col-md-8">

      
        <div >


            @{int indexBtn = 0;
                int indexCom = 10;}
            @foreach (var post in Model.Posts)
            {

                indexBtn++;
                indexCom++;



                <!--- \\\\\\\Post-->
                <div id="post" class="card gedf-card" @*style="margin-bottom:5px; margin-top:5px;"*@>
                    <div class="card-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="mr-2">
                                    <img class="rounded-circle" width="50" height="50" src="~/upload/@post.Authorimage" alt="">
                                </div>
                                <div class="ml-2">
                                    <div class="h5 m-0">@post.Author</div>
                                    <div class="h7 text-muted">@post.Date</div>
                                </div>
                            </div>
                            <div>
                                <div class="dropdown">
                                    <button class="btn btn-link dropdown-toggle" type="button" id="gedf-drop1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <i class="fa fa-ellipsis-h"></i>
                                    </button>
                                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="gedf-drop1">
                                        <div class="h6 dropdown-header">Configuration</div>
                                        <a class="dropdown-item" href="#">Save</a>
                                        <a class="dropdown-item" href="#">Hide</a>
                                        <a class="dropdown-item" href="#">Report</a>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                    <div class="card-body">
                        <div class="text-muted h7 mb-2"> <i class="fa fa-clock-o"></i>10 min ago</div>
                        <a class="card-link" href="#">
                            <h5 class="card-title">@post.Name</h5>
                        </a>
                        <div class="col-sm-6 col-md-4 col-lg-3 item">
                            @if (post.PostImage != null)
                            {
                                <a href="~/upload/@post.PostImage" data-lightbox="@post.PostImage"><img class="img-fluid" src="~/upload/@post.PostImage"></a>
                            }
                        </div>
                        <p class="card-text">
                            @post.Text

                        </p>
                    </div>
                    <div class="card-footer">
                        @*@Html.ActionLink("Edytuj", "EditPost", new { id = item.Id }) |
                            @Html.ActionLink("ViewPost", "ViewPost", new { id = item.Id }) |
                            @Html.ActionLink("Delete", "Delete", new { id = item.Id })*@

                        @*@Html.ActionLink("Dodaj Komentarz", "AddComment", new { postId = post.Id })*@

                        @*<a href="#" class="card-link"><i class="fa fa-gittip"></i> Like</a>*@
                        <button id="@indexBtn" value="@post.Id" class="btn3 btn btn-success" style="margin-left:4px">Komentarze</button>
                        @*<a href="#" class="card-link"><i class="fa fa-mail-forward"></i> Share</a>*@
                    </div>
                </div>

                //Komentarze
                <div class="card gedf-card" @*style="padding-top:5px"*@>
                    <div id="@indexCom" style="display: none" class="be-comment-block">
                        @*<h5>Komentarze</h5>
                                 @foreach (var com in ViewBag.Comments)
                                 {
                                     @if (com.PostId == post.Id)
                                     {

                                         <div class="be-comment">
                                             <div class="be-img-comment">
                                                 <a href="blog-detail-2.html">
                                                     <img src="~/upload/@com.ProfileImage" alt="" class="be-ava-comment">
                                                 </a>
                                             </div>
                                             <div class="be-comment-content">

                                                 <span class="be-comment-name">
                                                     <a href="blog-detail-2.html">@com.Author</a>
                                                 </span>
                                                 <span class="be-comment-time">
                                                     <i class="fa fa-clock-o"></i>
                                                     @com.Date
                                                 </span>

                                                 <p class="be-comment-text">
                                                     @com.Text
                                                 </p>
                                             </div>
                                         </div>
                                     }
                                 }

                                 <div>
                                     @await Html.PartialAsync("_AddCommentPartial", new PortalMonti.Application.ViewModels.Comment.NewCommentVm()
                            { PostId = post.Id })
                                 </div>*@
                    </div>
                </div>

                <!-- Post /////-->
            }
        </div>
    </div>


    <div class="col-md-4">
        <div class="push-down"></div>
        <div class="card card-columns">
            <h5 class="card-heading">Friends</h5>
            <div class="mda-list">
                @foreach (var friend in ViewBag.Friends)
                {
                    <div class="mda-list-item">
                        <img src="~/upload/@friend.UserPhoto" alt="List user" class="mda-list-item-img thumb48">
                        <div class="mda-list-item-text mda-2-line">
                            <h3><a href="#">@friend.Email</a></h3>
                            @Html.ActionLink("Zobacz Profil", "ViewProfile","Profile", new { appUserId = friend.AuthorId })
                            <div class="text-muted text-ellipsis">Ut ac nisi id mauris</div>
                        </div>
                    </div>
                }



            </div>
        </div>
    </div>
</div>




<br />
<br />








<ul class="pagination pagination-circle">


    @for (int i = 1; i <= Math.Ceiling((double)Model.Count / (double)Model.PageSize); i++)
    {
        <td>
            @if (i != Model.CurrentPage)
            {
            <li class="page-item " aria-current="page">
                <a class="page-link" href="javascript:PagerClick(@i)">@i </a>
            </li>

        }
        else
        {
            <li class="page-item active"><a class="page-link" href="javascript:PagerClick(@i)">@i</a></li>

        }
            </td>
        }

</ul>
<br />
<br />
<br>





@section Scripts
{
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script type="text/javascript">
        function PagerClick(index) {
            document.getElementById("pageNo").value = index;
            document.getElementById("pageNo").form.submit();
        }
    </script>

    <script>
     




        $(function () {
            console.log("strona gotowa");
        });
        $(document).ready(function () {
            $("#btn2").click(function () {
                $("#addpost").toggle(1500);
            });
        });



        $(document).ready(function () {
            
            for (let i = 1; i < 9; i++) {
                $("#"+i).click(function () {
                   
                    console.log("przycisk zostal klikniety");

                $.ajax({
                    type: "GET",
                    url: "@Url.Action("ShowComments")",
                    data: { postId: $("#"+i).val() },
                    dataType:"text",
                    success: function (data) {
                        $("#1" + i).toggle(1000); //zwijanie i rozwijanie, mozna dodac efekty
                        $("#1" + i).html(data); //wrzucenie w danego diva pobranych danych
                        

                $("#create").click(function () {
                    event.preventDefault();
                    console.log("kliknieto");
                $.ajax({
                    type: "POST",
                       url: "@Url.Action("AddCommentNew")",
                       data: { postId: $("#" + i).val(), text: $("#text").val() },
                    dataType:"text",
                    success: function (data) {
                        
                $.ajax({
                    type: "GET",
                    url: "@Url.Action("ShowComments")",
                    data: { postId: $("#" + i).val() },
                    dataType: "text",
                    success: function (data) {
                        
                        console.log("kliknieto create");
                        $("#1" + i).show(1000); //zwijanie i rozwijanie, mozna dodac efekty
                        $("#1" + i).html(data); //wrzucenie w danego diva pobranych danych
                        event.preventDefault(); 
                    }
                   })

                       }

                       });
                });

                                 }

                });
                     });

            }
            
        });
    </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>


}


<style type="text/css">
    body {
        background-color: #e9ebee;
    }

    .be-comment-block {
        margin-bottom: 50px !important;
        border: 1px solid #edeff2;
        border-radius: 2px;
        padding: 50px 70px;
        border: 1px solid #ffffff;
    }

    .comments-title {
        font-size: 16px;
        color: #262626;
        margin-bottom: 15px;
        font-family: 'Conv_helveticaneuecyr-bold';
    }

    .be-img-comment {
        width: 60px;
        height: 60px;
        float: left;
        margin-bottom: 15px;
    }

    .be-ava-comment {
        width: 60px;
        height: 60px;
        border-radius: 50%;
    }

    .be-comment-content {
        margin-left: 80px;
    }

        .be-comment-content span {
            display: inline-block;
            width: 49%;
            margin-bottom: 15px;
        }

    .be-comment-name {
        font-size: 13px;
        font-family: 'Conv_helveticaneuecyr-bold';
    }

    .be-comment-content a {
        color: #383b43;
    }

    .be-comment-content span {
        display: inline-block;
        width: 49%;
        margin-bottom: 15px;
    }

    .be-comment-time {
        text-align: right;
    }

    .be-comment-time {
        font-size: 11px;
        color: #b4b7c1;
    }

    .be-comment-text {
        font-size: 13px;
        line-height: 18px;
        color: #7a8192;
        display: block;
        background: #f6f6f7;
        border: 1px solid #edeff2;
        padding: 15px 20px 20px 20px;
    }

    .form-group.fl_icon .icon {
        position: absolute;
        top: 1px;
        left: 16px;
        width: 48px;
        height: 48px;
        background: #f6f6f7;
        color: #b5b8c2;
        text-align: center;
        line-height: 50px;
        -webkit-border-top-left-radius: 2px;
        -webkit-border-bottom-left-radius: 2px;
        -moz-border-radius-topleft: 2px;
        -moz-border-radius-bottomleft: 2px;
        border-top-left-radius: 2px;
        border-bottom-left-radius: 2px;
    }

    .form-group .form-input {
        font-size: 13px;
        line-height: 50px;
        font-weight: 400;
        color: #b4b7c1;
        width: 100%;
        height: 50px;
        padding-left: 20px;
        padding-right: 20px;
        border: 1px solid #edeff2;
        border-radius: 3px;
    }

    .form-group.fl_icon .form-input {
        padding-left: 70px;
    }

    .form-group textarea.form-input {
        height: 150px;
    }
</style>
